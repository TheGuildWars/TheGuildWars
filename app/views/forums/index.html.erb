<div class="page-header">
	<h1>Forums</h1>
</div>

<% if can? :new, Forum %>
<div class="row">
	<div class="span8">
		&nbsp;
	</div>
	<div class="span4">
		<%= link_to("New Forum", new_forum_path, class: "btn btn-success") %>
	</div>
</div>
<% end %>

<% @forums.each do |forum| %>
	<% if can? :read, forum %>
		<h2><%= forum.name %></h2>
		<% forum.children.each do |child| %>
			<% if can? :read, child %>
				<div class  = "row">
					<div class = "span1">
						&nbsp;
					</div>
					<div class = "span5">
						<%= link_to child.name, forum_topics_path(child) %><br />
						<%= child.description %>
					</div>
					<div class = "span1">
						<%= child.topics.count %>
					</div>
					<div class = "span1">
						<%= child.posts.count %>
					</div>
					<div class = "span4">
						<% if child.posts.count == 0 %>
						No Posts
						<% else %>
						Latest Post: <%= child.posts.last.topic.name %><br />
						By: <%= link_to child.posts.last.user.username, user_path(child.posts.last.user) %>
						<% end %>
					</div>
				</div>
			<% end %>
		<% end %>
	<% end %>
<% end %>